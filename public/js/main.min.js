"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}String.prototype.toUpperCaseFirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Lib=function(){function Lib(){_classCallCheck(this,Lib)}return _createClass(Lib,null,[{key:"objectKeyArray",value:function(obj){var arr=[];for(var key in obj)arr.push(key);return arr}},{key:"weightedRandom",value:function(obj){var total=0;for(var key in obj)total+=obj[key];var r=Math.random()*total;for(var key in obj){if(r<obj[key])return key;r-=obj[key]}}},{key:"randomProperty",value:function(obj){var total=0;for(var key in obj)total+=1;var r=Math.random()*total;for(var key in obj){if(1>r)return obj[key];r-=1}}},{key:"inCommonProperty",value:function(obj,obj2){var r={};for(var key in obj)"undefined"!=typeof obj2[key]&&(r[key]=obj[key]);return r}},{key:"notProperty",value:function(obj,exclude_arr){var r={};for(var key in obj)-1==exclude_arr.indexOf(key)&&(r[key]=obj[key]);return r}},{key:"deepCopy",value:function(obj){return JSON.parse(JSON.stringify(obj))}},{key:"isObjEmpty",value:function(obj){if(null==obj)return!0;if(obj.length>0)return!1;if(0===obj.length)return!0;for(var key in obj)if(obj.hasOwnProperty(key))return!1;return!0}},{key:"socialMediaPost",value:function(site,url){"facebook"==site?window.open("http://www.facebook.com/share.php?u="+url,"Facebook","width=550,height=400"):"twitter"==site&&window.open("http://twitter.com/intent/tweet?status="+$(document).find("title").text()+"+"+url,"Twitter","width=550,height=400")}},{key:"extractDomain",value:function(url){var domain;return domain=url.indexOf("://")>-1?url.split("/")[2]:url.split("/")[0],domain=domain.split(":")[0]}},{key:"resolveLinkMedia",value:function(link,callback){var ext=link.split(".").pop(),domain=this.extractDomain(link);if("jpg"==ext||"gif"==ext||"png"==ext||"webp"==ext)callback({type:"image",data:[{link:link}]});else if("imgur.com"==domain||"i.imgur.com"==domain){var imgur_id=link.split("/").pop(),imgur_api="https://api.imgur.com/3";link.match(/^https?:\/\/i?\.?imgur\.com\/a\/[a-z0-9]+$/gi)?$.ajax({url:imgur_api+"/album/"+imgur_id+".json",type:"GET",headers:{Authorization:"Client-ID 1a264d08fe7cd9c",Accept:"application/json"},dataType:"json",success:function(result){callback({type:"imgur",data:result.data.images})}}):link.match(/^https?:\/\/i?\.?imgur\.com\/[a-z0-9]+$/gi)?$.ajax({url:imgur_api+"/image/"+imgur_id+".json",type:"GET",headers:{Authorization:"Client-ID 1a264d08fe7cd9c",Accept:"application/json"},dataType:"json",success:function(result){callback({type:"imgur",data:[result.data]})}}):"gifv"==ext&&(imgur_id=imgur_id.split(".")[0],$.ajax({url:imgur_api+"/image/"+imgur_id+".json",type:"GET",headers:{Authorization:"Client-ID 1a264d08fe7cd9c",Accept:"application/json"},dataType:"json",success:function(result){callback({type:"imgur",data:[result.data]})}}))}}}]),Lib}(),Reddit=function(){function Reddit(){_classCallCheck(this,Reddit)}return _createClass(Reddit,null,[{key:"init",value:function(){this.$container=$("#aether-content"),this.$template=$("#aether-templates").find(".item"),this.subreddit=null,this.page=!1,this.processing=!1}},{key:"getSubreddit",value:function(subreddit){var _this=this;this.processing=!0,null!==subreddit&&(this.subreddit=subreddit,this.page=!1,this.fetchDescription(function(results){var description;description="error"===results?"/r/All /r/Funny /r/Pics /r/BattleStations /r/Aww":results.data.description_html,_this.descriptionSubreddits(description,function(subreddits){$("#aether-subreddit-list").html(""),subreddits.forEach(function(value){$("#aether-subreddit-list").append($("#aether-templates").find(".subreddit-li").clone().html(value))})})})),this.fetchSubreddit(function(results){_this.buildSubreddit(results.data.children,_this.page===!1),_this.page=results.data.after})}},{key:"buildSubreddit",value:function(posts,fresh){var _this2=this;fresh&&this.$container.html(""),posts.forEach(function(p){var _p$data=p.data,url=_p$data.url,permalink=_p$data.permalink,score=_p$data.score,title=(_p$data.thumbnail,_p$data.title),author=_p$data.author,num_comments=_p$data.num_comments,subreddit=(_p$data.saved,_p$data.subreddit),domain=_p$data.domain,reddit_url="https://reddit.com"+permalink,$item=_this2.$template.clone();$item.find(".title").html(title),$item.find(".subreddit").html("subreddit: "+subreddit),$item.find(".author").html("op: "+author),$item.find(".score").html("score: "+score),$item.find(".link-reddit").html('<a target="_blank" href="'+reddit_url+'">view on reddit ('+num_comments+" comments)</a>"),$item.find(".link-url").html('<a target="_blank" href="'+url+'">view on '+domain+"</a>"),Lib.resolveLinkMedia(url,function(media){"image"==media.type?$item.find(".aether-media").append('<img src="'+media.data[0].link+'">'):"imgur"==media.type&&media.data.forEach(function(image){if(0==image.animated)$item.find(".aether-media").append('<img src="'+image.link+'">');else{var $vid=$('<video autoplay="" loop="" muted="" preload="" class="aether-gifv"></video>');$vid.append($('<source src="'+image.webm+'" type="video/webm" class="aether-gifv-src-webm">')),$vid.append($('<source src="'+image.mp4+'" type="video/mp4" class="aether-gifv-src-mp4">')),$item.find(".aether-media").append($vid)}}),_this2.$container.append($item)})})}},{key:"fetchSubreddit",value:function(callback){if(null===this.subreddit)return!1;var url="https://www.reddit.com/r/"+this.subreddit+"/.json?raw_json=1&t=year";this.page!==!1&&(url+="&count=25&after="+this.page),$.getJSON(url,function(response){callback(response)})}},{key:"fetchDescription",value:function(callback){if(null===this.subreddit)return!1;var url="https://www.reddit.com/r/"+this.subreddit+"/about.json";$.getJSON(url,function(response){"undefined"==typeof response.error&&callback(response)}).error(function(){callback("error")})}},{key:"descriptionSubreddits",value:function(description,callback){var subreddits=description.match(/\/r\/[A-Z0-9]+/gi),subreddits_unique=[];subreddits.forEach(function(value){-1===subreddits_unique.indexOf(value)&&subreddits_unique.push(value)}),subreddits_unique.forEach(function(value){if(-1!==value.search(/[A-Z]/g)){var lower_case_version=subreddits_unique.indexOf(value.toLowerCase());-1!==lower_case_version&&(subreddits_unique[lower_case_version]="")}});var subreddits_uppercase=[];subreddits_unique.forEach(function(value){""!=value&&subreddits_uppercase.push(value.replace("/r/","").toUpperCaseFirst())}),subreddits_uppercase.sort(),callback(subreddits_uppercase)}}]),Reddit}();Reddit.init(),$("#aether-nav").find("form").on("submit",function(){var subreddit=$("#aether-subreddit").val();return Reddit.getSubreddit(subreddit),$("html, body").animate({scrollTop:"0px"},"fast"),!1}).trigger("submit"),$("#aether-load-more").on("click",function(){return Reddit.getSubreddit(null),!1}),$(window).on("keydown",function(e){40==e.keyCode&&!function(){e.preventDefault();var $next=!1,current_scroll=document.body.scrollTop;$("#aether-content").find(".item").each(function(index,value){$(value).offset().top>current_scroll+40&&$next===!1&&($next=$(value))}),$next!==!1&&$("html, body").animate({scrollTop:$next.offset().top-40+"px"},"fast")}(),38==e.keyCode&&!function(){e.preventDefault();var $next=!1,current_scroll=document.body.scrollTop;$($("#aether-content").find(".item").get().reverse()).each(function(index,value){$(value).offset().top<current_scroll+40&&$next===!1&&($next=$(value))}),$next!==!1&&$("html, body").animate({scrollTop:$next.offset().top-40+"px"},"fast")}()});